/**
 * @name os2display screen-bundle
 * @version v1.0.0
 * @link https://github.com/os2display/screen-bundle
 */
angular.module("screenApp").config(["$translateProvider",function(e){"use strict";e.useSanitizeValueStrategy("escape").useStaticFilesLoader({prefix:"bundles/os2displayscreen/apps/screenApp/translations/locale-",suffix:".json"}).preferredLanguage("da").fallbackLanguage("da").forceAsyncReload(!0)}]),angular.module("screenApp").service("screenAppSetup",["busService","userService","$translate","$filter","$http","$timeout",function(i,e,a,n,c,r){"use strict";function d(n){n.scope.hasOwnProperty("screenBundleOpenPreview")||(n.scope.screenBundleOpenPreview=function(e){n.scope.screenBundleShowPreview=e},n.scope.screenBundleClosePreview=function(){r(function(){n.scope.$apply(function(){n.scope.screenBundleShowPreview=null})})})}i.$on("itkHeader.list.element.requestItems",function(e,l){if(l&&("screen"===l.type||"channel"===l.type)){d(l);var n='  <div tooltips tooltip-template="'+a.instant("screen.app.start_preview")+'" tooltip-side="top">    <a ng-click="screenBundleOpenPreview('+l.entity.id+')" class="os2display-screen-bundle--play-icon-active">       <img class="os2display-screen-bundle--play-icon" src="bundles/os2displayscreen/assets/icons/play.svg"/>    </a>  </div>',s="/screen/display"+("channel"===l.type?"_channel":"")+"/"+l.entity.id;n=n+'<span data-ng-if="screenBundleShowPreview === '+l.entity.id+'"><screen-bundle-preview preview-url="'+s+'" close="screenBundleClosePreview()"></screen-bundle-preview></span></div>',i.$emit(l.returnEvent,{html:n}),c.get("/screen/api/publicly_available"+("channel"===l.type?"_channel":"")+"/"+l.entity.id).then(function(e){if(e.data.enabled){var n='  <div tooltips tooltip-template="'+a.instant("screen.app.public")+'" tooltip-side="top">    <div class="os2display-screen-bundle--icon-container"><img class="os2display-screen-bundle--unlocked-icon" src="bundles/os2displayscreen/assets/icons/public.svg"></div>  </div>';i.$emit(l.returnEvent,{html:n})}})}}),i.$on("itkHeader.settings.extra-fields.requestItems",function(e,n){if("screen"===n.type||"channel"===n.type){n.scope.screenBundlePublicUrl=null,n.scope.screenBundlePublicEnabled=null;var l="",s="/screen/display"+("channel"===n.type?"_channel":"")+"/"+n.entity.id;l="screen"===n.type?"/screen/api/publicly_available/"+n.entity.id:"/screen/api/publicly_available_channel/"+n.entity.id,c.get(l).then(function(e){r(function(){n.scope.$apply(function(){n.scope.screenBundlePublicUrl=e.data.publicUrl,n.scope.screenBundlePublicEnabled=e.data.enabled})})},function(e){404!==e.status&&console.log(e)}),n.scope.hasOwnProperty("screenBundleTogglePublicAvailable")||(n.scope.screenBundleTogglePublicAvailable=function(){c.post(l,{enabled:!n.scope.screenBundlePublicEnabled}).then(function(e){r(function(){n.scope.$apply(function(){n.scope.screenBundlePublicUrl=e.data.publicUrl,n.scope.screenBundlePublicEnabled=e.data.enabled})})},function(e){404!==e.status&&console.log(e)})}),d(n);var t='<form class="cpw--wrapper" data-info="From: screen-bundle"><div class="cpw--text"><label class="cpw--text-label">'+a.instant("screen.extra_fields.preview")+'</label><button class="cpw--add-channels-item-action os2display-screen-bundle--extra-fields-button" data-ng-click="screenBundleOpenPreview('+n.entity.id+')">'+a.instant("screen.extra_fields.preview_button")+'</button><p class="os2display-screen-bundle--preview-button-text">'+a.instant("screen.extra_fields.preview_text")+'</p><span data-ng-if="screenBundleShowPreview === '+n.entity.id+'"><screen-bundle-preview preview-url="'+s+'" close="screenBundleClosePreview()"></screen-bundle-preview></span></div><div class="cpw--text"><label class="cpw--text-label">'+a.instant("screen.extra_fields.publicly_available")+'</label><button data-ng-click="screenBundleTogglePublicAvailable()" class="os2display-screen-bundle--extra-fields-button" data-ng-class="{\'cpw--add-channels-item-action\': !screenBundlePublicEnabled, \'cpw--selected-channels-item-action\': screenBundlePublicEnabled}"><span data-ng-if="screenBundlePublicEnabled">'+a.instant("screen.extra_fields.publicly_available_toggle_enabled")+'</span><span data-ng-if="!screenBundlePublicEnabled">'+a.instant("screen.extra_fields.publicly_available_toggle_disabled")+'</span></button></div><div class="cpw--text" data-ng-if="screenBundlePublicEnabled && screenBundlePublicUrl"><label class="cpw--text-label">'+a.instant("screen.extra_fields.public_url")+'</label><textarea type="text" class="cpw--text-input" readonly="readonly" data-ng-model="screenBundlePublicUrl"></div></form>';i.$emit(n.returnEvent,{html:t})}})}]),angular.module("screenApp").directive("screenBundlePreview",["$timeout","busService","$window",function(n,s,t){return{restrict:"E",replace:!0,scope:{previewUrl:"@",close:"&"},link:function(l){function e(){n(function(){l.sWidth=l.selectedAspectRatio.w,l.sHeight=l.selectedAspectRatio.h;var e=null;e=0===l.selectedAspectRatio.id?1200:675;var n=Math.min(t.innerWidth-40,e);l.scale=n/l.sWidth,t.innerWidth<=e?l.margin=null:l.margin="0 "+Math.max(40,(t.innerWidth-n)/2)+"px"})}s.$emit("bodyService.addClass","is-locked"),l.aspectRatios=[{id:0,w:1920,h:1080,name:"16:9 (Full HD)"},{id:1,w:1080,h:1920,name:"9:16 (Full HD portrait)"}],l.selectedAspectRatio=l.aspectRatios[0],l.sWidth=1920,l.sHeight=1080,l.transformOrigin="0 0",angular.element(t).on("resize",e),l.$watch("selectedAspectRatio",function(){e()}),l.$on("$destroy",function(){s.$emit("bodyService.removeClass","is-locked"),angular.element(t).off("resize",e)})},templateUrl:"/bundles/os2displayscreen/apps/screenApp/preview/preview.html"}}]);